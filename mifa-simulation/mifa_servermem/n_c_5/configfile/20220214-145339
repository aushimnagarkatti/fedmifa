import lenet
import numpy as np

#Generic Hyp
batch_size= 64 #Neural Network batch size
n_rnds= 1000 #Global rounds
tau=5 #Local rounds --> not in use since we use local epochs
total_c= 250 #Total no of clients
no_of_c=[5] #participating clients
local_epochs = 5 
plot_local_train_loss = False


#Cluster
K= 55        #try for 5,10,20. Number of clusters is predetermined for static
cluster = 1
clust_mech = 'static' #'static 

#Model
model_type = 'lenet' #shakespeare_lstm' #'shakespeare_lstm'#'cnnmnist'#'cnnmnist' #'r'
dataset = 'cifar10'

#Plotting
plot_every_n = 20



#Learning rate
algo_lr = {  #lr for each algo, length has to be the same for all algos
    0: [1/np.power(10,2)],
    1: [1/np.power(10,1)],
    2: [1/np.power(10,2)],
    3: [1/np.power(10,1.5)]
    }

lrfactor = {
    0:1, #factor to reduce lr in scheduler
    1:1,
    2:1,
    3:1
    }

sch_freq = 200 #scheduler every n rounds



#select algos to run
d_algo = {
            0: "MIFA",
            1: "UMIFA",
            2: "FedAvg",
            3: "scaffold"
        }




#MIFA paper paradigm variables
#p_i min is for the paper's paradigm for client selection, each client is selected with a min prob of 0.2
pi_min = 0.2
sel_client_variablepi = False #variable no of clients selected each round according to pi assigned
enforce_cp_r1 = False #enforce all client part in 1st round


loss_algo = [[2.214344675540924, 1.9356887924671171, 1.595756412744522, 0.9038327625393867, 0.9101112765073778, 0.9893017327785494, 0.5733600458526052, 0.47305331229174047, 0.8345779290795325, 0.7126742127537729, 0.6086591818928719, 0.6845299489051104, 0.6458511389791965, 0.5533988613076508, 0.641953784674406, 0.5100638404488563, 0.6445763234049082, 0.4234617084183265, 0.5548952309926972, 0.5481507823849097, 0.45535317346453674, 0.4318869333155454, 0.42507142223417765, 0.4081905471079518, 0.5530146631971001, 0.5857557002454996, 0.4284177816763986, 0.4249604370055022, 0.4971039952524007, 0.3363029397034552, 0.4823860472440719, 0.3706406680122018, 0.6590215615928173, 0.44417883940041064, 0.32793753387057223, 0.40213221590500325, 0.42980278426199214, 0.2702671885973541, 0.42611281920224436, 0.34517318665923086, 0.3238815881888149, 0.3582319812080823, 0.43452669227495794, 0.27281783055514097, 0.39869311909249516, 0.23230913348845209, 0.34308927174657583, 0.393114886037074, 0.4005704227520619, 0.3834068672731519], [1.5000055080652237, 0.8455226854779175, 1.0892746214568614, 1.0834049512445927, 1.0640318205952646, 0.9982920652627945, 0.5812201812796411, 0.519466318031773, 0.943539044559002, 0.807456511259079, 0.7531719191372395, 0.7434215973317623, 0.6733806275948881, 0.6694309964403511, 0.6791332488134503, 0.5611800168454646, 0.7177928481996059, 0.4262571720496634, 0.4951094437506981, 0.6688533916787127, 0.5187049998342992, 0.45384535966441036, 0.4765481856837869, 0.42463455062883443, 0.5580761075578631, 0.5633486715145409, 0.4423280793230515, 0.49468686668017653, 0.5000704630464315, 0.36804714410740413, 0.5669537163525821, 0.4191375069320202, 0.5924148709326983, 0.5021723275631665, 0.40394812541300784, 0.427093774760142, 0.4394086223776686, 0.34780357441632076, 0.5131898695230485, 0.3945048311726714, 0.45002959545425253, 0.36109290239763137, 0.38804767319001254, 0.3693714511650615, 0.2993409882928245, 0.2451875420403667, 0.4075119732692838, 0.45744094529654833, 0.3794699601272441, 0.42389202318154273], [2.2152163767814637, 0.6845735901920126, 0.8333429306745529, 0.6625049620866775, 0.7912420132756234, 0.8132636621594429, 0.44014008913189173, 0.3298614366329275, 0.7500581385195255, 0.6239089003950358, 0.48436638660728926, 0.6230576757714152, 0.5569601152837277, 0.5533795785903931, 0.6058067448437214, 0.4793889556080103, 0.5757262263819575, 0.40803802385460586, 0.5131059842091054, 0.4830887592810904, 0.40452235989505425, 0.40109752724878495, 0.3839295314438641, 0.32314897888572885, 0.49671796094626186, 0.5731017707102, 0.3690953410667135, 0.3990709850634448, 0.4807431626971811, 0.3293110791983781, 0.5573898976482451, 0.3467151339817792, 0.5529521664232016, 0.44442057815380387, 0.32293908360938073, 0.414500414263457, 0.5014504659269005, 0.26031881167087706, 0.3990825540572406, 0.3008823964931071, 0.2720880968007259, 0.32647018214804124, 0.3884132653102279, 0.28035311223939063, 0.30979208851174916, 0.23878640220384115, 0.33361209924332796, 0.37690159801160916, 0.40504322074877563, 0.40203909607604144], [1.7864808797836305, 0.6694677031243919, 0.8200569920241833, 0.7064897076040506, 0.8355436735600232, 0.9186553925275802, 0.5806887601290873, 0.42105819355696444, 0.7616267236322164, 0.740696510374546, 0.5854763589799404, 0.7801184533536434, 0.744994737431407, 0.6309594925586135, 0.7011552746593952, 0.5387510276585817, 0.7227796179801225, 0.554595687398687, 0.5566869504097849, 0.6070417070575058, 0.543930793479085, 0.4738101046159864, 0.5003203246742487, 0.37861134427366777, 0.5668449971824885, 0.5789743065088986, 0.45170237605459995, 0.5055287884298013, 0.501175936004147, 0.4437771720008459, 0.541585668027401, 0.46180494798347355, 0.6303516147285698, 0.6388023497909308, 0.36395062682917345, 0.42807401385158295, 0.5516034927207512, 0.33542671926552436, 0.40675728796049954, 0.5263626800570638, 0.3445217045582831, 0.46153777957428244, 0.491450736746192, 0.34791068371385336, 0.41291839406825603, 0.2396705443691462, 0.3810416233167052, 0.47257869687629855, 0.4757592031394597, 0.4487487015686929]]
acc_algo = [[tensor(0.1094), tensor(0.1094), tensor(0.2344), tensor(0.1719), tensor(0.1719), tensor(0.3281), tensor(0.3906), tensor(0.2500), tensor(0.3750), tensor(0.4062), tensor(0.3281), tensor(0.4531), tensor(0.3906), tensor(0.4844), tensor(0.4531), tensor(0.4688), tensor(0.4688), tensor(0.4688), tensor(0.4688), tensor(0.5469), tensor(0.4688), tensor(0.5000), tensor(0.5312), tensor(0.5156), tensor(0.5625), tensor(0.5469), tensor(0.5781), tensor(0.5312), tensor(0.5469), tensor(0.5469), tensor(0.4688), tensor(0.6094), tensor(0.5156), tensor(0.5625), tensor(0.6094), tensor(0.5312), tensor(0.5156), tensor(0.5938), tensor(0.5625), tensor(0.5000), tensor(0.6094), tensor(0.5312), tensor(0.6250), tensor(0.5469), tensor(0.6094), tensor(0.5938), tensor(0.5781), tensor(0.6406), tensor(0.5781), tensor(0.6250)], [tensor(0.1094), tensor(0.1094), tensor(0.1406), tensor(0.2500), tensor(0.1562), tensor(0.1719), tensor(0.2344), tensor(0.4219), tensor(0.3281), tensor(0.3750), tensor(0.3438), tensor(0.4062), tensor(0.3750), tensor(0.3750), tensor(0.3906), tensor(0.4219), tensor(0.4531), tensor(0.5000), tensor(0.4375), tensor(0.4375), tensor(0.4844), tensor(0.5156), tensor(0.5000), tensor(0.5469), tensor(0.5000), tensor(0.4844), tensor(0.5312), tensor(0.4844), tensor(0.3750), tensor(0.5469), tensor(0.4531), tensor(0.4844), tensor(0.4844), tensor(0.4688), tensor(0.4844), tensor(0.5625), tensor(0.4219), tensor(0.4844), tensor(0.4688), tensor(0.4844), tensor(0.5000), tensor(0.4844), tensor(0.4531), tensor(0.5156), tensor(0.4531), tensor(0.5312), tensor(0.5156), tensor(0.5469), tensor(0.3906), tensor(0.4688)], [tensor(0.0938), tensor(0.1094), tensor(0.1562), tensor(0.2188), tensor(0.1719), tensor(0.2656), tensor(0.1719), tensor(0.3438), tensor(0.4062), tensor(0.3281), tensor(0.3438), tensor(0.3906), tensor(0.4062), tensor(0.3281), tensor(0.3750), tensor(0.4688), tensor(0.3438), tensor(0.3750), tensor(0.2969), tensor(0.5312), tensor(0.4688), tensor(0.5156), tensor(0.2812), tensor(0.2656), tensor(0.4531), tensor(0.5156), tensor(0.5156), tensor(0.5000), tensor(0.4375), tensor(0.3906), tensor(0.5156), tensor(0.3750), tensor(0.4375), tensor(0.2812), tensor(0.3438), tensor(0.5781), tensor(0.3125), tensor(0.3906), tensor(0.4688), tensor(0.5469), tensor(0.3281), tensor(0.4688), tensor(0.5469), tensor(0.5156), tensor(0.4062), tensor(0.5000), tensor(0.5781), tensor(0.3750), tensor(0.4844), tensor(0.4062)], [tensor(0.0938), tensor(0.2031), tensor(0.2031), tensor(0.3125), tensor(0.1875), tensor(0.3125), tensor(0.1719), tensor(0.5000), tensor(0.4688), tensor(0.4219), tensor(0.5312), tensor(0.4375), tensor(0.4844), tensor(0.5156), tensor(0.5156), tensor(0.5312), tensor(0.4219), tensor(0.4375), tensor(0.4062), tensor(0.5625), tensor(0.5312), tensor(0.4844), tensor(0.3906), tensor(0.4375), tensor(0.3906), tensor(0.5312), tensor(0.5000), tensor(0.4531), tensor(0.4844), tensor(0.4688), tensor(0.4844), tensor(0.5156), tensor(0.4375), tensor(0.5312), tensor(0.5000), tensor(0.4844), tensor(0.4219), tensor(0.4531), tensor(0.5000), tensor(0.5156), tensor(0.4688), tensor(0.5000), tensor(0.5625), tensor(0.5469), tensor(0.4375), tensor(0.4844), tensor(0.5312), tensor(0.4844), tensor(0.5312), tensor(0.5312)]]
test_loss_algo= [[2.3063247203826904, 2.306387424468994, 2.45255184173584, 2.2443418502807617, 2.1493561267852783, 1.93555748462677, 2.0010316371917725, 2.0911149978637695, 1.7497069835662842, 1.8194111585617065, 1.7646114826202393, 1.5633456707000732, 1.613994836807251, 1.5742805004119873, 1.5877078771591187, 1.4820716381072998, 1.5141011476516724, 1.4673779010772705, 1.43312406539917, 1.4025042057037354, 1.4191460609436035, 1.4339865446090698, 1.413285493850708, 1.3933393955230713, 1.3564822673797607, 1.3195332288742065, 1.2968288660049438, 1.3124854564666748, 1.271439790725708, 1.2943412065505981, 1.2922918796539307, 1.24869966506958, 1.3254755735397339, 1.2473150491714478, 1.2263233661651611, 1.2257713079452515, 1.2499607801437378, 1.2689391374588013, 1.242021083831787, 1.3045191764831543, 1.236535668373108, 1.2622860670089722, 1.2199522256851196, 1.2167218923568726, 1.215523362159729, 1.1952358484268188, 1.2221269607543945, 1.2091259956359863, 1.2502338886260986, 1.22849440574646], [2.329913854598999, 2.437408208847046, 2.287465810775757, 2.17813777923584, 2.2515573501586914, 2.074409246444702, 2.008908987045288, 1.9487197399139404, 1.9329192638397217, 1.8566678762435913, 1.829917550086975, 1.8026485443115234, 1.7370431423187256, 1.7111154794692993, 1.6762462854385376, 1.653556227684021, 1.6400824785232544, 1.5084147453308105, 1.5926942825317383, 1.584859013557434, 1.4396313428878784, 1.4688535928726196, 1.5021263360977173, 1.4495569467544556, 1.5289393663406372, 1.4173506498336792, 1.4401841163635254, 1.488891839981079, 1.561529278755188, 1.4405659437179565, 1.491477370262146, 1.409022331237793, 1.421571969985962, 1.4055346250534058, 1.5322532653808594, 1.3966811895370483, 1.4427496194839478, 1.4994556903839111, 1.424436092376709, 1.4654027223587036, 1.403948187828064, 1.4131333827972412, 1.4409033060073853, 1.398781418800354, 1.5522003173828125, 1.4764654636383057, 1.4784812927246094, 1.4703634977340698, 1.5462732315063477, 1.4560025930404663], [2.3127381801605225, 2.574927568435669, 2.2714180946350098, 2.3056952953338623, 2.151259422302246, 2.0966885089874268, 2.7570013999938965, 2.0904037952423096, 1.806195616722107, 1.7451549768447876, 2.1770853996276855, 1.7737427949905396, 1.5822250843048096, 1.8302288055419922, 1.5855132341384888, 1.559309482574463, 1.7046912908554077, 1.7241281270980835, 1.8088597059249878, 1.5131494998931885, 1.6899052858352661, 1.4624145030975342, 1.880623459815979, 2.223902463912964, 1.4933640956878662, 1.4343621730804443, 1.549355387687683, 1.4360277652740479, 1.6372636556625366, 1.6218057870864868, 1.3227521181106567, 1.8318620920181274, 1.462842345237732, 1.9574830532073975, 1.9625780582427979, 1.285400390625, 1.857169508934021, 2.064312219619751, 1.8635576963424683, 1.5073498487472534, 1.7883713245391846, 1.6816844940185547, 1.9064217805862427, 1.3661881685256958, 1.8151789903640747, 1.4325779676437378, 1.4754225015640259, 1.675000786781311, 1.4203784465789795, 2.0130205154418945], [2.8329007625579834, 2.2564384937286377, 2.0372955799102783, 1.8312313556671143, 2.070436716079712, 1.8087942600250244, 2.0708467960357666, 1.5695040225982666, 1.6486717462539673, 1.4750229120254517, 1.5166763067245483, 1.5584423542022705, 1.571184754371643, 1.536107063293457, 1.456820011138916, 1.625810980796814, 1.6944546699523926, 1.6924675703048706, 1.6269431114196777, 1.5602269172668457, 1.559814691543579, 1.4208500385284424, 1.8392530679702759, 1.672960877418518, 1.885856032371521, 1.5299770832061768, 1.5051803588867188, 1.3662753105163574, 1.5835771560668945, 1.5258913040161133, 1.5257420539855957, 1.668239712715149, 1.5125882625579834, 1.462099313735962, 1.7036943435668945, 1.4443246126174927, 1.4981669187545776, 1.5122888088226318, 1.6404566764831543, 1.589133381843567, 1.4936902523040771, 1.4025753736495972, 1.5635104179382324, 1.376230239868164, 1.7682396173477173, 1.58218252658844, 1.4862855672836304, 1.3994207382202148, 1.4273605346679688, 1.506171464920044]]
global_train_loss_algo = [[2.304161326354727, 2.301798876594095, 2.39846808312799, 2.27004770366737, 2.1176404858489173, 2.2986056091230544, 2.1708963133794876, 2.1139363413271695, 2.1227206571022874, 1.9634177149714107, 1.890166498053714, 1.8278045805214007, 1.7753138311988557, 1.7056115280331858, 1.696306250589278, 1.6413560415167943, 1.5870722305134435, 1.6326820586648438, 1.6050764887839022, 1.6158116235757423, 1.6694619529082646, 1.5526537570502141, 1.559065718937408, 1.554013279088013, 1.5095784327258235, 1.5651777136661207, 1.4615777730941772, 1.5107423153984578, 1.4845347436492706, 1.46931761640417, 1.4609900868457297, 1.4271145130667235, 1.4236562736808795, 1.4459974384673722, 1.327397989952351, 1.3809012788945756, 1.4056268367925873, 1.3507232117226056, 1.3875888046401237, 1.3498778404177303, 1.3645980201108987, 1.32863240717622, 1.3137117554159725, 1.3331688317801336, 1.2878551204186266, 1.2823590724669454, 1.2546968272579906, 1.2923131158284824, 1.2629657515784358, 1.2946940242786846], [2.292127606508982, 2.373654313099659, 2.212930503403744, 2.1963638103831453, 2.2359341322003727, 2.136593411950504, 1.9561376503056578, 1.9720387876491108, 1.979010467943938, 1.884818141112852, 1.9091765063498027, 1.8652264972781891, 1.7331890523281244, 1.801846649793103, 1.825438088315832, 1.7155010191071065, 1.658122224880911, 1.7156538266660002, 1.6695781481235534, 1.729462268864712, 1.6933810189556893, 1.7080247647622053, 1.5658003721395721, 1.5555305246197049, 1.5200169036150588, 1.5248208699933707, 1.5935151727912982, 1.5047289930341188, 1.5128129926483955, 1.5185158030151407, 1.4974668088471492, 1.4036052355071162, 1.4822057447470058, 1.4534693108800123, 1.405384961753855, 1.4280932324621685, 1.3638407822765048, 1.5578962285500353, 1.4425915949179997, 1.4316822930675028, 1.3459476854490198, 1.368134130449856, 1.408339442956783, 1.3290951029418985, 1.4433595708873876, 1.404438414689525, 1.3291081650482723, 1.4133767444459373, 1.372554283770149, 1.341623040568798], [2.298009160229617, 2.6989131976881295, 2.402774198890647, 2.667272468966901, 2.13991254766274, 2.263550555309676, 2.3349027109268072, 2.435259497683981, 1.9142659843120429, 1.782115833991019, 2.148629975440862, 1.827746785052902, 1.951078975292118, 2.0243565620058943, 2.0127199651944974, 1.7100384974723581, 1.7591025219549, 1.980737031878108, 1.9900752761784721, 1.9003801688818676, 2.296335377046824, 1.9112087687872865, 1.6324483150106561, 2.671135575874992, 1.6350923865042684, 1.725785960626724, 1.6793570472761188, 1.5493897637137977, 1.9154112540242616, 1.7818784436301502, 1.425814653601488, 1.7483184470240112, 1.6085191112954904, 2.151766234041785, 1.592243717911908, 1.4260533984054995, 1.5269944186100874, 2.148576824561409, 1.5056116757795328, 1.66849673480329, 1.7931902393355699, 1.7689726651477082, 1.9023043575799068, 1.4057338777405526, 1.8193889763349158, 1.712264566165407, 1.5451932660758954, 1.4567089256118326, 1.4645909621282611, 1.7851587591878593], [2.57330323942482, 2.327481130199969, 2.1961922477883147, 2.0259105288768975, 1.9115604136301123, 1.9395430353291505, 1.7381887785004229, 2.0164719257513277, 1.7216092649933017, 1.7587350692285602, 1.765460280658644, 1.6762340309674784, 1.6049593017839106, 1.5760342149478395, 1.6353566745662933, 1.7379913134952945, 1.5368949671840424, 1.8801512512404595, 1.5997937254588623, 2.013116869780109, 2.0711657121358322, 1.860222246488342, 1.5014802679381407, 2.2300836823480514, 1.69577060712268, 1.6743498546693025, 1.5505017007098478, 1.4557596701185416, 1.8469743251495654, 1.3433535719466636, 1.4147391354336458, 1.5655949908449216, 1.4060998740403547, 1.4093356935874275, 1.4525076368885577, 1.5184083026083535, 1.3407019382852423, 1.3710519171431852, 1.3791858550837583, 1.5128068652604243, 1.311849798540325, 1.2242373461308687, 1.4220368662453673, 1.4280491587146165, 2.06218413379796, 1.8654556004592524, 1.1921414595735653, 1.1779475172462366, 1.6288255032371073, 1.6124736962415982]]
