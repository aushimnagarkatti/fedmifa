import lenet
import numpy as np

#Generic Hyp
batch_size= 64 #Neural Network batch size
n_rnds= 1500 #Global rounds
tau=5 #Local rounds --> not in use since we use local epochs
total_c= 250 #Total no of clients
no_of_c=[5] #participating clients
local_epochs = 5 
plot_local_train_loss = False


#Cluster
K= 55        #try for 5,10,20. Number of clusters is predetermined for static
cluster = 1
clust_mech = 'static' #'static 

#Model
model_type = 'lenet' #shakespeare_lstm' #'shakespeare_lstm'#'cnnmnist'#'cnnmnist' #'r'
dataset = 'cifar10'

#Plotting
plot_every_n = 20



#Learning rate
algo_lr = {  #lr for each algo, length has to be the same for all algos
    0: [1/np.power(10,2)],
    1: [1/np.power(10,1.5)],
    2: [1/np.power(10,1.5)],
    3: [1/np.power(10,1.5)]
    }

lrfactor = {
    0:1, #factor to reduce lr in scheduler
    1:0.5,
    2:0.5,
    3:0.5
    }

sch_freq = 200 #scheduler every n rounds



#select algos to run
d_algo = {
            # 0: "MIFA",
            1: "UMIFA",
            2: "FedAvg",
            3: "scaffold"
        }




#MIFA paper paradigm variables
#p_i min is for the paper's paradigm for client selection, each client is selected with a min prob of 0.2
pi_min = 0.2
sel_client_variablepi = False #variable no of clients selected each round according to pi assigned
enforce_cp_r1 = False #enforce all client part in 1st round


loss_algo = [[2.1702653968334196, 0.7511055252701043, 1.018478255867958, 0.9020880454778671, 0.9267803245782853, 0.9306573855876923, 0.5507048089616001, 0.508059439380886, 0.8695914617180824, 0.8141251876950264, 0.6346449823677539, 0.7812453705072404, 0.7169165959954261, 0.6748922364413737, 0.7626920826733112, 0.7126303149014712, 0.8109336083382368, 0.5132591797411441, 0.6233438709657639, 0.6491714899009093, 0.5859552175924182, 0.5502541071921587, 0.624730635434389, 0.4410401598038153, 0.6466486212238669, 0.75134192943573, 0.5996152994874864, 0.6626672015967779, 0.6658751241862774, 0.5216834704298525, 0.6487129943072796, 0.5568501674383879, 0.7505463635921478, 0.6585477408766746, 0.5519091719854623, 0.6587271212041378, 0.642341837324202, 0.44442606013268227, 0.6842872443795204, 0.5967482946300879, 0.5256685716100037, 0.48829807240515954, 0.5473473563045264, 0.512304012030363, 0.5247081851772964, 0.46265274524688726, 0.538103800714016, 0.6264335897471756, 0.6808701464813203, 0.6324193081259727, 0.5920692282915115, 0.4894538796925917, 0.5757719615660608, 0.6980348178744316, 0.5764446674287319, 0.6325658947229386, 0.6334948758780956, 0.3952644648123532, 0.4194508992135525, 0.41357118111103774, 0.6287281293887645, 0.5788778755627572, 0.5614224434830248, 0.6234581653773784, 0.6615010166168213, 0.7589672696590423, 0.6788864520937204, 0.5011348558589817, 0.5983028588816524, 0.47640914822928604, 0.7759045922756196, 0.7251078942418098, 0.7563165694475174, 0.7800314071774482, 0.7420402452349663], [2.168147294521332, 0.6966270723077469, 0.8194841361045837, 0.6672301517054439, 0.7579941954463719, 0.7333506107330322, 0.4709013482718728, 0.35344759125378916, 0.7409027495980263, 0.5069621183723212, 0.47215184427797796, 0.5158169298339635, 0.5261761663109065, 0.5259529414772988, 0.5800832743942737, 0.41917808571830395, 0.5330120783671737, 0.3498858502483927, 0.46180032591335474, 0.43154976250603794, 0.3541591812763363, 0.36779543168842793, 0.3225583959091455, 0.3027571591816377, 0.46321835355833174, 0.5250995070114731, 0.3583560922447941, 0.34496996811940334, 0.4757423840835691, 0.3212850012746639, 0.5184022875875234, 0.348194038560614, 0.5472291278839111, 0.47419761095196017, 0.3690573124936781, 0.3729384701140225, 0.5117032597935759, 0.25914254201343284, 0.4179141738265752, 0.3217313680611551, 0.31799808974377813, 0.35231193820014595, 0.38192128496244554, 0.3089658488612622, 0.3303249059943482, 0.2738568706950173, 0.3629548175726086, 0.3961788488877937, 0.4464778668479995, 0.4449523905664682, 0.4341700029326603, 0.29009068637154994, 0.39593060858082024, 0.42244652088731527, 0.384330273848027, 0.382412522174418, 0.36384880885481835, 0.31326112251030286, 0.27256515840068457, 0.24533001464791596, 0.3727671679598279, 0.37640069405548277, 0.3790450676158071, 0.4359281709045172, 0.39204261790961026, 0.49270445024594667, 0.41064420480281116, 0.31695000347681346, 0.3267454383987934, 0.2836308070365339, 0.4849168191105127, 0.3976758145913482, 0.5316058868169784, 0.4400197556242347, 0.4464845542050898], [2.1717641389369966, 0.6908327150729019, 0.9588031613826751, 0.7867537641525268, 0.9348135459423066, 0.9563568258285521, 0.5417017572569602, 0.45846184976864607, 0.9787162494659423, 0.8004848816990853, 0.49931788131594657, 0.7522174276411533, 0.7530384258925914, 0.6368591837584973, 0.7664093036949635, 0.5489003144949675, 0.8311309135705234, 0.5000124150887132, 0.6416572423279285, 0.7572791150212288, 0.47826914712786683, 0.4726438942179084, 0.4916642016172409, 0.35339296062942593, 0.7335294957458973, 0.8163907673209906, 0.6379515541158617, 0.5588391839293763, 0.6353435143455862, 0.4732775095943362, 0.5984251199662686, 0.4767584611475468, 0.9785828810930252, 0.7523690238595009, 0.5776714870706201, 0.6360587523877621, 0.792740833372809, 0.432852190323174, 0.7103834702074527, 0.6519908725656569, 0.47864306800067424, 0.5376532728597523, 0.6418320231884718, 0.5291659395396711, 0.5796876933798194, 0.4373718955740332, 0.6284387727081775, 0.9491046530008316, 0.9996805616468191, 0.8386500191688538, 0.532744699716568, 0.48819556824862953, 0.6012801521643996, 0.7185618133842946, 0.7289998098462821, 0.8948158008605243, 0.6978838084638118, 0.529972743424587, 0.49948958307504654, 0.47157642242498693, 0.5317629812657833, 0.5396624752506614, 0.5311900051683188, 0.6783048678934573, 0.6392098698019982, 0.8107301136851313, 0.7008221642673015, 0.4764509631693364, 0.6503455301374197, 0.4903142987936736, 0.7101976607739926, 0.6118059062957764, 0.6626370793581009, 0.7417815074324607, 0.6603260207176209]]
acc_algo = [[tensor(0.0469), tensor(0.1562), tensor(0.1719), tensor(0.2031), tensor(0.2344), tensor(0.1719), tensor(0.2969), tensor(0.3750), tensor(0.3125), tensor(0.3438), tensor(0.3594), tensor(0.3125), tensor(0.2812), tensor(0.2969), tensor(0.3438), tensor(0.2812), tensor(0.3125), tensor(0.2969), tensor(0.3125), tensor(0.3281), tensor(0.2812), tensor(0.3281), tensor(0.2969), tensor(0.2500), tensor(0.3125), tensor(0.3594), tensor(0.3750), tensor(0.3438), tensor(0.3281), tensor(0.4219), tensor(0.3438), tensor(0.3750), tensor(0.4219), tensor(0.3594), tensor(0.3438), tensor(0.3750), tensor(0.3125), tensor(0.4219), tensor(0.3125), tensor(0.3750), tensor(0.3594), tensor(0.3281), tensor(0.3438), tensor(0.3594), tensor(0.3281), tensor(0.3594), tensor(0.3750), tensor(0.3906), tensor(0.3906), tensor(0.3750), tensor(0.3750), tensor(0.4375), tensor(0.3125), tensor(0.3594), tensor(0.4062), tensor(0.4219), tensor(0.4375), tensor(0.4219), tensor(0.4219), tensor(0.3750), tensor(0.4062), tensor(0.3906), tensor(0.4062), tensor(0.4219), tensor(0.3906), tensor(0.4219), tensor(0.4219), tensor(0.4062), tensor(0.3750), tensor(0.4062), tensor(0.4375), tensor(0.3594), tensor(0.3438), tensor(0.3438), tensor(0.3906)], [tensor(0.0938), tensor(0.0469), tensor(0.2188), tensor(0.2188), tensor(0.2344), tensor(0.2812), tensor(0.1094), tensor(0.3438), tensor(0.3906), tensor(0.3281), tensor(0.4062), tensor(0.4062), tensor(0.4531), tensor(0.4375), tensor(0.4531), tensor(0.4688), tensor(0.4219), tensor(0.4375), tensor(0.3438), tensor(0.4688), tensor(0.4844), tensor(0.5312), tensor(0.3906), tensor(0.3750), tensor(0.4688), tensor(0.5156), tensor(0.5312), tensor(0.4375), tensor(0.5000), tensor(0.5000), tensor(0.5156), tensor(0.4531), tensor(0.4531), tensor(0.2969), tensor(0.3906), tensor(0.5469), tensor(0.3438), tensor(0.4219), tensor(0.5156), tensor(0.5625), tensor(0.4219), tensor(0.4219), tensor(0.5312), tensor(0.5312), tensor(0.5000), tensor(0.4844), tensor(0.4688), tensor(0.4531), tensor(0.5000), tensor(0.4688), tensor(0.4844), tensor(0.3906), tensor(0.5000), tensor(0.4531), tensor(0.4844), tensor(0.2188), tensor(0.4688), tensor(0.4062), tensor(0.5156), tensor(0.5156), tensor(0.5000), tensor(0.5625), tensor(0.5000), tensor(0.2812), tensor(0.5156), tensor(0.4375), tensor(0.5000), tensor(0.4844), tensor(0.4219), tensor(0.4375), tensor(0.5000), tensor(0.4688), tensor(0.3438), tensor(0.5469), tensor(0.5000)], [tensor(0.0938), tensor(0.0938), tensor(0.1875), tensor(0.2500), tensor(0.2031), tensor(0.3125), tensor(0.1250), tensor(0.3750), tensor(0.3906), tensor(0.3906), tensor(0.4531), tensor(0.3750), tensor(0.4688), tensor(0.5000), tensor(0.4062), tensor(0.5312), tensor(0.3906), tensor(0.3594), tensor(0.3438), tensor(0.4219), tensor(0.4844), tensor(0.5312), tensor(0.3906), tensor(0.4062), tensor(0.5625), tensor(0.4688), tensor(0.5469), tensor(0.5000), tensor(0.5312), tensor(0.5000), tensor(0.5781), tensor(0.4531), tensor(0.5156), tensor(0.4219), tensor(0.4531), tensor(0.4688), tensor(0.5312), tensor(0.4844), tensor(0.4531), tensor(0.4531), tensor(0.4531), tensor(0.5625), tensor(0.4844), tensor(0.5781), tensor(0.4844), tensor(0.4844), tensor(0.4688), tensor(0.4844), tensor(0.5938), tensor(0.5312), tensor(0.5469), tensor(0.4062), tensor(0.4531), tensor(0.6250), tensor(0.5938), tensor(0.4375), tensor(0.5625), tensor(0.6250), tensor(0.6250), tensor(0.5625), tensor(0.5469), tensor(0.5469), tensor(0.5469), tensor(0.4688), tensor(0.5781), tensor(0.5312), tensor(0.5156), tensor(0.5938), tensor(0.5938), tensor(0.5625), tensor(0.5156), tensor(0.5156), tensor(0.5938), tensor(0.5156), tensor(0.6094)]]
test_loss_algo= [[2.310842752456665, 2.407987356185913, 2.3463633060455322, 2.2396187782287598, 2.181741714477539, 2.083325147628784, 2.02290940284729, 1.9424103498458862, 1.9175810813903809, 1.8957977294921875, 1.9059178829193115, 1.9574540853500366, 1.9584237337112427, 1.8877040147781372, 1.8491897583007812, 1.8458442687988281, 1.8239822387695312, 1.8468254804611206, 1.8068844079971313, 1.8286629915237427, 1.8349931240081787, 1.7983777523040771, 1.8127868175506592, 1.8694162368774414, 1.815812110900879, 1.7962713241577148, 1.7465332746505737, 1.7718329429626465, 1.7757221460342407, 1.7445626258850098, 1.758102536201477, 1.7137913703918457, 1.7132848501205444, 1.769002079963684, 1.7354215383529663, 1.7619636058807373, 1.801707148551941, 1.718374252319336, 1.767403244972229, 1.7673386335372925, 1.6876975297927856, 1.7722210884094238, 1.720048189163208, 1.734595537185669, 1.7398794889450073, 1.7353947162628174, 1.7385438680648804, 1.7238699197769165, 1.6886253356933594, 1.7052841186523438, 1.7413312196731567, 1.719812035560608, 1.7282460927963257, 1.726332187652588, 1.681527853012085, 1.6967930793762207, 1.716474175453186, 1.7175360918045044, 1.6862761974334717, 1.6935184001922607, 1.7269554138183594, 1.7171045541763306, 1.713576316833496, 1.689960241317749, 1.705536961555481, 1.7294617891311646, 1.7145755290985107, 1.7082151174545288, 1.740722894668579, 1.7130439281463623, 1.7161765098571777, 1.7770531177520752, 1.7471438646316528, 1.7450200319290161, 1.7413103580474854], [2.31864070892334, 2.6868200302124023, 2.138434886932373, 2.1076109409332275, 1.9774271249771118, 2.182155132293701, 2.5667483806610107, 2.079573631286621, 1.7658803462982178, 1.7939820289611816, 1.8881272077560425, 1.6560909748077393, 1.3948687314987183, 1.6849688291549683, 1.4887285232543945, 1.4565790891647339, 1.5864967107772827, 1.703848123550415, 1.8820793628692627, 1.5652201175689697, 1.4918228387832642, 1.3438581228256226, 1.7326029539108276, 1.9605722427368164, 1.4925529956817627, 1.4032076597213745, 1.4614112377166748, 1.4110075235366821, 1.5125033855438232, 1.4293327331542969, 1.2641867399215698, 1.5927306413650513, 1.362583875656128, 1.9272654056549072, 1.7072398662567139, 1.298052430152893, 1.770975947380066, 1.8147835731506348, 1.6500145196914673, 1.3575873374938965, 1.6183195114135742, 1.5769474506378174, 1.5507619380950928, 1.3633413314819336, 1.4877171516418457, 1.363101840019226, 1.5531349182128906, 1.4508687257766724, 1.3337994813919067, 1.6003344058990479, 1.4091182947158813, 1.6636271476745605, 1.3756732940673828, 1.3860026597976685, 1.5749601125717163, 2.2160160541534424, 1.6278494596481323, 1.5499988794326782, 1.3421255350112915, 1.2954740524291992, 1.6887933015823364, 1.211065411567688, 1.2131832838058472, 2.602881669998169, 1.2766002416610718, 1.574580192565918, 1.3425841331481934, 1.3838199377059937, 1.7720255851745605, 1.465079665184021, 1.571044921875, 1.4277030229568481, 1.774009108543396, 1.4093332290649414, 1.3701634407043457], [2.3179869651794434, 2.6522397994995117, 2.168194532394409, 1.9843019247055054, 2.0933399200439453, 1.9960474967956543, 2.3196561336517334, 1.8564988374710083, 1.7380701303482056, 1.6079024076461792, 1.7465074062347412, 1.7368204593658447, 1.4944303035736084, 1.5008739233016968, 1.4665632247924805, 1.4601961374282837, 1.5489909648895264, 1.5271581411361694, 1.8479926586151123, 1.662817120552063, 1.5683284997940063, 1.4051342010498047, 1.5470162630081177, 1.7787648439407349, 1.3628183603286743, 1.404131293296814, 1.4233486652374268, 1.348499059677124, 1.4510221481323242, 1.4509118795394897, 1.327635407447815, 1.4987125396728516, 1.3716394901275635, 1.3998976945877075, 1.4766695499420166, 1.4124614000320435, 1.361859917640686, 1.4039747714996338, 1.5409350395202637, 1.39854896068573, 1.4170644283294678, 1.3402185440063477, 1.3670483827590942, 1.3360927104949951, 1.4440609216690063, 1.312780499458313, 1.318666696548462, 1.3585224151611328, 1.357616662979126, 1.2879855632781982, 1.340067982673645, 1.4417691230773926, 1.3795266151428223, 1.2562977075576782, 1.2772184610366821, 1.488660454750061, 1.3024685382843018, 1.2248557806015015, 1.2405651807785034, 1.3135427236557007, 1.3314316272735596, 1.2284650802612305, 1.242590308189392, 1.438601016998291, 1.2168470621109009, 1.3368219137191772, 1.2662129402160645, 1.2170592546463013, 1.3223896026611328, 1.2694257497787476, 1.2618595361709595, 1.2883070707321167, 1.2566081285476685, 1.2965662479400635, 1.226804494857788]]
global_train_loss_algo = [[2.3026314675045745, 2.4046599999108276, 2.237252190594783, 2.2735666045752327, 2.2014904994793865, 2.193448455742253, 2.067137775518705, 2.064277517521168, 2.0693297035553875, 1.9916614830646369, 2.026842260909507, 2.031627234595511, 1.8870543540286286, 1.944397702089051, 1.9014046811081868, 1.8445913898365578, 1.8485413012297258, 1.9038842238123765, 1.8613330264530523, 1.8194113027714098, 1.796493065631603, 1.802076133468267, 1.8946308103363838, 1.8194796628964223, 1.7608909132840382, 1.8044576048851013, 1.7781910842946729, 1.795021463842953, 1.731068261901436, 1.734173229588267, 1.769439074389465, 1.7527998082168268, 1.7984631806993119, 1.694620840079949, 1.7777178279884027, 1.7092294130483856, 1.6941701399395839, 1.7005477312885586, 1.710002883620884, 1.7023353082749544, 1.7786661455088564, 1.7228825833181591, 1.7332338076418319, 1.7203241524184147, 1.7031205801097937, 1.7065736280987636, 1.693872079367528, 1.7304454526632949, 1.7363116096352678, 1.686457298295882, 1.719871088366984, 1.7138975488255397, 1.8061795179801219, 1.685087921064528, 1.727869733520176, 1.697807480459628, 1.7026245850126456, 1.699946503657514, 1.709641445170888, 1.7233170653548082, 1.6963017541734153, 1.7126494220760473, 1.6890935333793426, 1.7520156595713037, 1.7601882106507831, 1.715660286833868, 1.7073796438744, 1.7133561299585016, 1.6911440964245126, 1.6975354584281708, 1.7351549212889903, 1.6893908738175316, 1.7009565008570775, 1.7146911535726483, 1.7079499818175041], [2.2960004544319093, 2.761846181071933, 2.243162412472698, 2.304162573326579, 1.849399234937585, 2.258044034623734, 2.081194040415537, 2.3198501069832336, 1.7949548176182506, 1.7415320969298673, 1.9425622485482785, 1.6832399907929207, 1.6149737078820348, 1.8989309763054714, 1.7065681528557293, 1.5673835087005439, 1.5649211661285147, 1.9761326532534627, 1.7763877779321597, 1.889821498747677, 2.0843561357244504, 1.8630099548098376, 1.3934338717814296, 2.4785511100383673, 1.5558072676134231, 1.7091318439034855, 1.674320639551753, 1.536111338669077, 1.857600414539542, 1.5237656619847584, 1.3801855225392314, 1.6009768564682787, 1.512546021920031, 2.1433301725046103, 1.5578316297677473, 1.3713705827817892, 1.4696698396102241, 1.910155651362046, 1.5059425061011253, 1.5860500719846058, 1.558928947314582, 1.7445390161955754, 1.7627351628544996, 1.5217090524980783, 1.6748716504982366, 1.742279726678453, 1.7209900120640045, 1.4102322046104294, 1.5460286428556418, 1.6658390699445134, 1.4794468769941793, 1.567198586738323, 1.2287790051201726, 1.71141263972158, 1.6977276692305074, 1.761298833753142, 1.8578295003422691, 1.5201961420990926, 1.685240786093885, 1.327606207879303, 1.742776689779423, 1.4000371319558613, 1.4344551651679036, 2.2964304798399398, 1.2759983222502882, 1.4434098326946463, 1.5803461786731126, 1.5486561386176692, 1.8879853862020977, 1.5937058628367646, 1.4677709565138268, 1.7031406212950606, 1.9792491790583677, 1.5011044411403138, 1.5622194918525187], [2.2961156865215058, 2.7120105573893203, 2.248777796240414, 2.1166955763116824, 1.9513586314437945, 1.9800535640143373, 1.7961726885317537, 1.9760134471651842, 1.7915322623594339, 1.7389200259657467, 1.8803852031298, 1.7563398456024697, 1.6604461840656408, 1.6909027294734555, 1.6089397065169977, 1.662492002824993, 1.7216131501185619, 1.7145080746287276, 1.825756550902296, 1.8725486391645563, 1.8793487943651732, 1.6789007153352509, 1.400779659180995, 2.1890408285438556, 1.5560784269781673, 1.6533218829528145, 1.6166743785524003, 1.568497503352592, 1.7589565320393008, 1.509386077866225, 1.530250667153722, 1.5765128495443204, 1.7359261532573749, 1.6205747061983093, 1.404787874740103, 1.6650814017676332, 1.3541522277590563, 1.6455422906619508, 1.507065360350987, 1.6119015608602167, 1.4613759572548635, 1.511660073114478, 1.5280137792267763, 1.6664010027180547, 1.6146965784489955, 1.6497530607921083, 1.448880680839119, 1.3958407338622891, 1.6080769690711174, 1.454656601714356, 1.446940252695547, 1.45128488007104, 1.3588285540680751, 1.6564940560199415, 1.513946337773062, 1.383000448841573, 1.4758827224411928, 1.5038477502515555, 1.538756334415787, 1.4299602528362323, 1.5082258894620344, 1.4448638038562083, 1.5079496579097056, 1.4485244758598639, 1.3862832278546775, 1.4139712161725135, 1.5252221502611398, 1.5027975673260896, 1.4220173454955412, 1.620653805372965, 1.4056897725900421, 1.5279467846731396, 1.4726991863811718, 1.3836623928735934, 1.4122204364413191]]
