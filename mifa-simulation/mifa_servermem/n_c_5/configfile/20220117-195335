import lenet
import numpy as np

#Generic Hyp
batch_size= 64 #Neural Network batch size
n_rnds= 2000 #Global rounds
tau=5 #Local rounds --> not in use since we use local epochs
total_c= 250 #Total no of clients
no_of_c=[5] #participating clients
local_epochs = 5 
plot_local_train_loss = True


#Cluster
K= 5        #try for 5,10,20
cluster = 0

#Model
model_type = 'cnnmnist' #'r'
dataset = 'emnist'#cifar10'

#Plotting
plot_every_n = 20



#Learning rate
algo_lr = {  #lr for each algo, length has to be the same for all algos
    0: [0.1],#[1/np.power(10,2.5)],
    1: [0.1],#[1/np.power(10,2)],
    2: [0.1]#[1/np.power(10,2)]
    }

lrfactor = {
    0:1, #factor to reduce lr in scheduler
    1:1,
    2:1
    }

sch_freq = 200 #scheduler every n rounds



#select algos to run
d_algo = {
            0: "MIFA",
            1: "UMIFA",
            2: "FedAvg"
        }




#MIFA paper paradigm variables
#p_i min is for the paper's paradigm for client selection, each client is selected with a min prob of 0.2
pi_min = 0.2
sel_client_variablepi = False #variable no of clients selected each round according to pi assigned
enforce_cp_r1 = False #enforce all client part in 1st round


Loss algo: [[3.6578465347290043, 3.68814253171285, 3.562950980186462, 3.5738680636088054, 3.4520421306292213, 3.390073429107666, 3.2136243120829264, 3.0781777941385906, 2.6810077913602197, 2.6399005508422855, 2.647648827234904, 2.7735754350026443, 2.4584306852022806, 2.325721692721049, 2.2612424103418984, 2.1274284601211546, 2.2162881927490234, 2.244982825517654, 1.8981452757517498, 1.7237368941307067, 2.275933269659678, 1.829622535387675, 1.7358833869298298, 1.785426168282827, 1.7215906111399335, 1.6047819078763326, 1.5532219052314757, 1.663969507376353, 1.656933201154073, 1.3904358379046122, 1.5092953459421792, 1.340544127225876, 1.3702518926064173, 1.4411538330316545, 1.4192985328038534, 1.370583582719167, 1.2192772956192495, 1.3443883099158604, 1.2323556387424468, 1.1638310714562734, 1.3301077036062874, 1.1326744819482168, 1.171883220831553, 1.427707525809606, 1.033889283100764, 1.1958524969418847, 1.3069138487180072, 1.2740595808029176, 1.135212757984797, 1.178432412703832, 1.197003756483396, 0.9236026966571809, 1.1775846003691355, 0.8345563602447509, 0.9906673436164857, 1.2177479738791783, 1.0433411862850188, 0.9423859385649364, 0.881371330420176, 0.8531554597218831, 1.1456353271007538, 0.9197655089696248, 1.0777562444607418, 1.2584151652654012, 1.195884064833323, 1.0368689820369084, 0.882013822476069, 0.9013072388966877, 1.0679791858593624, 0.9568008287747702, 0.9164373027483622, 1.0457329423030217, 0.9650283307234446, 1.329727382818858, 1.0466125497023264, 1.2144791827599208, 0.7531130323410034, 0.9836885459721089, 0.9739275880654652, 0.7800457954009374, 1.1260498459339143, 1.0573055351028842, 0.8333256602287292, 0.8904868125915527, 0.9409722220897674, 1.0431534404059248, 0.8187469998995465, 0.9510117282867432, 0.8626326221227647, 0.7545213522513706, 0.8401588967641194, 0.792726717957606, 0.9819811270634332, 0.8422984017133712, 0.9367075928052266, 1.233921109313766, 0.6785770256519317, 0.9023629587491353, 0.8784826564788819, 1.0291147887706757], [3.795022154490153, 2.5941813739140827, 1.8380617211659747, 1.8369495872656505, 1.4411466842889786, 1.2781860500971476, 1.212847372293472, 0.9822298630078634, 0.9128359379371007, 0.8064069171746573, 0.7063655343651771, 0.990155141512553, 1.3035141137440998, 0.8701111548741659, 0.8027925846576691, 0.8865614158908526, 0.6958978265523911, 1.128738220135371, 0.6474449315071105, 0.5659561904271443, 1.0237033877770108, 0.6262453644673031, 0.764892061551412, 0.8032621054251988, 0.7230277342473467, 0.7147351036469142, 0.6570798045396805, 0.6816023240685464, 0.7699519179264704, 0.5505323612689972, 0.6951569374402364, 0.6234989298383395, 0.625922924131155, 0.7208416942954063, 0.7807865377267201, 0.8024976933002472, 0.6351597174008689, 0.7665025714039801, 0.6247244576613109, 0.5315094540516536, 0.7407106281320254, 0.6004231917858124, 0.7501343227624894, 0.8463494641383489, 0.5774943752288818, 0.8607656922737756, 0.7700588325659435, 0.6645931659539541, 0.649870655576388, 0.6150458711783091, 0.6795622464815775, 0.4921012575427691, 0.626236783305804, 0.42620483244458834, 0.5447885962526003, 0.7832842618227005, 0.5597097023377816, 0.6392329434553783, 0.4444345539808273, 0.4319046493172645, 0.849327125052611, 0.5299224712451299, 0.5528689703370133, 0.7574904510974884, 0.6696410470207533, 0.6976245495279629, 0.5471901690165202, 0.5796496213475864, 0.5749877341439327, 0.692261730035146, 0.6524619263013204, 0.6731734984020392, 0.5660108783046404, 0.8124236328403155, 0.6710778728723525, 0.8283089403311411, 0.4394754027922948, 0.6522267630199592, 0.6256278241475423, 0.4906945915222168, 0.7140321518580118, 0.804676122466723, 0.4999930825829506, 0.6182442121903102, 0.6603955001632371, 0.7516676139272749, 0.5165524492661159, 0.6558597896893819, 0.6089636415243149, 0.5004319877425829, 0.5687890849113464, 0.5388344474509359, 0.6923060067991414, 0.5855540184577306, 0.6429347449541092, 0.6352514571368617, 0.4640499800344308, 0.7295410268704096, 0.5303227212031683, 0.7064547071854272], [3.7508684876759846, 2.607965722084045, 1.8542448720932003, 1.7857043924331664, 1.40478306889534, 1.2957342499097189, 1.226640417178472, 0.9763010368347167, 0.8931075523296992, 0.8508998322486878, 1.0058525987155735, 0.9719074416557948, 1.2443690042495728, 0.9062180840174359, 0.7972346954345703, 0.8715911522507668, 0.7711015720367431, 0.9183515990277131, 0.6324103908141454, 0.5653076058626175, 1.0541832981506984, 0.6552465183536212, 0.7779833334684373, 0.8283315986792246, 0.835267656803131, 0.7453481427033741, 0.6610289979974429, 0.6397731383045514, 0.6989321001370747, 0.5066229291756947, 0.7181909670432409, 0.6138328696290652, 0.6362019689629476, 0.688746556421121, 0.7975550684332847, 0.7415266644954681, 0.5843788859248161, 0.7903421653310458, 0.568846483429273, 0.5475891773899396, 0.7243301557501157, 0.59976749954621, 0.6750034831762314, 1.8531952713330586, 0.5481313054164252, 0.6293793728550275, 0.8101358205080033, 0.6573138728936513, 0.6383796203931172, 0.6226760002175966, 0.6421901455124219, 0.4958048154910406, 0.6301810368299483, 0.44459131186207135, 0.5170934543609619, 0.6280570547779402, 0.6045572766065597, 0.4727221149206161, 0.4621043197313945, 0.4328760164777437, 0.7575941141446432, 0.5038943895200888, 0.5251445974459251, 0.7079712884426117, 0.6578597394625346, 0.6421778560380141, 0.5684883080323537, 0.6014100145498912, 0.7443897121747336, 0.5201114485661189, 0.5358817425966262, 0.6755896214048068, 0.5643828485012053, 0.7018660516242186, 0.6722591235637665, 0.6910694323016408, 0.3933689312736193, 0.6093205792891482, 0.5722985450824102, 0.455924342567722, 0.723042148510615, 0.6619977851274113, 0.4921904300153256, 0.60126802666982, 0.6499742040534815, 0.7443642837802569, 0.5243371796210606, 0.5896458649337293, 0.5419931054115296, 0.507469656864802, 0.5707509027719497, 0.5162681534389655, 0.6603561533490817, 0.5405469074646632, 0.6326501508553822, 0.635437069577165, 0.4381399600009123, 0.6142757656375567, 0.5087076888171335, 0.6811204659938812]]
Acc algo: [[tensor(0.0156), tensor(0.0156), tensor(0.0469), tensor(0.0312), tensor(0.0312), tensor(0.0312), tensor(0.0312), tensor(0.0625), tensor(0.0469), tensor(0.0312), tensor(0.1406), tensor(0.1250), tensor(0.1250), tensor(0.1094), tensor(0.1406), tensor(0.1719), tensor(0.1406), tensor(0.2031), tensor(0.2188), tensor(0.2188), tensor(0.2344), tensor(0.3281), tensor(0.2969), tensor(0.2500), tensor(0.2031), tensor(0.2500), tensor(0.3906), tensor(0.3594), tensor(0.3438), tensor(0.3438), tensor(0.3125), tensor(0.3281), tensor(0.3281), tensor(0.3438), tensor(0.4219), tensor(0.4375), tensor(0.4219), tensor(0.3906), tensor(0.3750), tensor(0.3750), tensor(0.3438), tensor(0.3281), tensor(0.3438), tensor(0.3750), tensor(0.4062), tensor(0.4062), tensor(0.4062), tensor(0.3594), tensor(0.3438), tensor(0.3281), tensor(0.3281), tensor(0.3750), tensor(0.4219), tensor(0.3906), tensor(0.4062), tensor(0.4062), tensor(0.3906), tensor(0.3281), tensor(0.2969), tensor(0.2969), tensor(0.3281), tensor(0.3281), tensor(0.3594), tensor(0.3750), tensor(0.4062), tensor(0.3906), tensor(0.3906), tensor(0.3906), tensor(0.3906), tensor(0.3594), tensor(0.4062), tensor(0.3906), tensor(0.4375), tensor(0.4375), tensor(0.4375), tensor(0.4531), tensor(0.4062), tensor(0.3906), tensor(0.3906), tensor(0.4062), tensor(0.4531), tensor(0.4531), tensor(0.4375), tensor(0.4688), tensor(0.4375), tensor(0.4531), tensor(0.4375), tensor(0.4375), tensor(0.4531), tensor(0.4688), tensor(0.3750), tensor(0.3125), tensor(0.3125), tensor(0.3594), tensor(0.4062), tensor(0.4531), tensor(0.4688), tensor(0.4844), tensor(0.5000), tensor(0.5000)], [tensor(0.), tensor(0.1094), tensor(0.3125), tensor(0.2969), tensor(0.3438), tensor(0.4375), tensor(0.4375), tensor(0.4688), tensor(0.4531), tensor(0.3750), tensor(0.4688), tensor(0.5000), tensor(0.3750), tensor(0.4688), tensor(0.4688), tensor(0.4062), tensor(0.5156), tensor(0.4688), tensor(0.4531), tensor(0.3906), tensor(0.5312), tensor(0.5469), tensor(0.4844), tensor(0.4844), tensor(0.5156), tensor(0.5156), tensor(0.5156), tensor(0.5781), tensor(0.5156), tensor(0.4531), tensor(0.5469), tensor(0.5781), tensor(0.5469), tensor(0.5312), tensor(0.6094), tensor(0.5938), tensor(0.5469), tensor(0.5469), tensor(0.4688), tensor(0.5625), tensor(0.5938), tensor(0.4844), tensor(0.5469), tensor(0.4062), tensor(0.5469), tensor(0.5781), tensor(0.5312), tensor(0.5312), tensor(0.5625), tensor(0.4844), tensor(0.5469), tensor(0.5312), tensor(0.5625), tensor(0.4531), tensor(0.5625), tensor(0.5781), tensor(0.4219), tensor(0.5469), tensor(0.5625), tensor(0.5000), tensor(0.5156), tensor(0.5938), tensor(0.5469), tensor(0.4688), tensor(0.5312), tensor(0.5156), tensor(0.5469), tensor(0.5469), tensor(0.5469), tensor(0.5781), tensor(0.5312), tensor(0.6250), tensor(0.5781), tensor(0.6250), tensor(0.4531), tensor(0.5781), tensor(0.5469), tensor(0.4688), tensor(0.5781), tensor(0.5781), tensor(0.5781), tensor(0.5312), tensor(0.5156), tensor(0.5312), tensor(0.5000), tensor(0.4531), tensor(0.5625), tensor(0.5781), tensor(0.5312), tensor(0.5625), tensor(0.5938), tensor(0.4375), tensor(0.5625), tensor(0.5625), tensor(0.5781), tensor(0.5781), tensor(0.5625), tensor(0.5625), tensor(0.5000), tensor(0.5000)], [tensor(0.0312), tensor(0.0938), tensor(0.2656), tensor(0.3125), tensor(0.3438), tensor(0.3906), tensor(0.3750), tensor(0.4531), tensor(0.4844), tensor(0.3906), tensor(0.4219), tensor(0.4688), tensor(0.3594), tensor(0.4844), tensor(0.5000), tensor(0.4688), tensor(0.6094), tensor(0.4531), tensor(0.5312), tensor(0.4375), tensor(0.4531), tensor(0.5625), tensor(0.4844), tensor(0.5469), tensor(0.5312), tensor(0.4688), tensor(0.5625), tensor(0.5938), tensor(0.5469), tensor(0.4375), tensor(0.5312), tensor(0.5312), tensor(0.5312), tensor(0.5781), tensor(0.5781), tensor(0.5000), tensor(0.6562), tensor(0.5469), tensor(0.4219), tensor(0.4531), tensor(0.5469), tensor(0.5781), tensor(0.5781), tensor(0.2812), tensor(0.5781), tensor(0.5312), tensor(0.4844), tensor(0.4844), tensor(0.4375), tensor(0.5625), tensor(0.5312), tensor(0.5938), tensor(0.5469), tensor(0.4375), tensor(0.6094), tensor(0.5781), tensor(0.4531), tensor(0.3750), tensor(0.5156), tensor(0.6094), tensor(0.5156), tensor(0.5781), tensor(0.6094), tensor(0.5156), tensor(0.4062), tensor(0.5000), tensor(0.5156), tensor(0.5469), tensor(0.5469), tensor(0.5625), tensor(0.5781), tensor(0.5781), tensor(0.5781), tensor(0.6719), tensor(0.4844), tensor(0.6250), tensor(0.5469), tensor(0.5469), tensor(0.4688), tensor(0.6094), tensor(0.6406), tensor(0.5469), tensor(0.6250), tensor(0.4531), tensor(0.5781), tensor(0.4375), tensor(0.5625), tensor(0.6562), tensor(0.3750), tensor(0.4375), tensor(0.6094), tensor(0.5781), tensor(0.5312), tensor(0.6562), tensor(0.5469), tensor(0.5469), tensor(0.6094), tensor(0.5469), tensor(0.3906), tensor(0.5312)]]
test_loss_algo: [[4.1285481452941895, 4.09912109375, 4.0790276527404785, 4.693035125732422, 5.71205472946167, 5.484710693359375, 4.25095796585083, 3.558767080307007, 3.2151496410369873, 3.004237174987793, 2.9415268898010254, 2.850022554397583, 2.7621967792510986, 2.818927526473999, 2.8546125888824463, 2.766947031021118, 2.6312990188598633, 2.5105056762695312, 2.472541570663452, 2.4257652759552, 2.4382317066192627, 2.540759563446045, 2.536989450454712, 2.502795457839966, 2.4137215614318848, 2.2630648612976074, 2.169062614440918, 2.1633057594299316, 2.233232021331787, 2.2467615604400635, 2.188159227371216, 2.081867218017578, 1.982969880104065, 1.906315803527832, 1.924630045890808, 1.972554087638855, 1.952383279800415, 1.9051271677017212, 1.917720079421997, 1.9832465648651123, 2.014822483062744, 2.003899574279785, 1.9811452627182007, 1.9592305421829224, 1.8901013135910034, 1.7660619020462036, 1.7117445468902588, 1.7871569395065308, 1.8722002506256104, 1.9025309085845947, 1.9009456634521484, 1.934074878692627, 1.9013352394104004, 1.8104248046875, 1.7359076738357544, 1.7125033140182495, 1.7295647859573364, 1.7727497816085815, 1.8263906240463257, 1.864020586013794, 1.8486788272857666, 1.7785730361938477, 1.7580465078353882, 1.7644494771957397, 1.7841136455535889, 1.7783253192901611, 1.7342666387557983, 1.7121598720550537, 1.7053343057632446, 1.6670854091644287, 1.6278965473175049, 1.6030895709991455, 1.6120011806488037, 1.6286518573760986, 1.6453142166137695, 1.6739541292190552, 1.716899037361145, 1.7518627643585205, 1.7332147359848022, 1.6702836751937866, 1.6471344232559204, 1.6521172523498535, 1.6520206928253174, 1.6281516551971436, 1.5817792415618896, 1.5703980922698975, 1.5916945934295654, 1.6052336692810059, 1.646103024482727, 1.7574715614318848, 1.8925559520721436, 1.9870084524154663, 1.9967597723007202, 1.877260446548462, 1.7816112041473389, 1.7642347812652588, 1.784667730331421, 1.7959601879119873, 1.7870393991470337, 1.7395620346069336], [4.079830646514893, 2.8384461402893066, 2.458738088607788, 2.1494650840759277, 2.0603816509246826, 1.510656476020813, 1.4929624795913696, 1.669228434562683, 1.668926477432251, 1.8919495344161987, 1.5385195016860962, 1.6369482278823853, 1.779529333114624, 1.6009773015975952, 1.6894279718399048, 1.7234892845153809, 1.4001131057739258, 1.6071960926055908, 1.5057495832443237, 1.9690327644348145, 1.4971436262130737, 1.3457268476486206, 1.5884699821472168, 1.6098438501358032, 1.4067051410675049, 1.6667574644088745, 1.6719355583190918, 1.2986929416656494, 1.492506504058838, 2.0004546642303467, 1.4290525913238525, 1.3713862895965576, 1.4794584512710571, 1.3964009284973145, 1.1537480354309082, 1.3205289840698242, 1.2029584646224976, 1.1714348793029785, 1.6173992156982422, 1.450049877166748, 1.4318431615829468, 1.6780641078948975, 1.4822989702224731, 2.034745216369629, 1.5430916547775269, 1.2100865840911865, 1.5185050964355469, 1.3596736192703247, 1.4241936206817627, 1.6771939992904663, 1.2686614990234375, 1.5357593297958374, 1.4291785955429077, 1.6463687419891357, 1.2756961584091187, 1.3970370292663574, 1.8619967699050903, 1.3991411924362183, 1.3548704385757446, 1.523299217224121, 1.3412227630615234, 1.204642653465271, 1.2788640260696411, 1.4601186513900757, 1.4867713451385498, 1.3289231061935425, 1.3922678232192993, 1.515572190284729, 1.2994565963745117, 1.4291969537734985, 1.3964943885803223, 1.0962060689926147, 1.2174270153045654, 1.2073415517807007, 1.4947901964187622, 1.3509212732315063, 1.2608383893966675, 1.6072392463684082, 1.2683840990066528, 1.3206440210342407, 1.1743533611297607, 1.4637941122055054, 1.4427801370620728, 1.756980538368225, 1.5289814472198486, 1.76641845703125, 1.2775856256484985, 1.2573496103286743, 1.4824004173278809, 1.3338310718536377, 1.1346098184585571, 2.074453115463257, 1.2752344608306885, 1.287609577178955, 1.3967812061309814, 1.3069736957550049, 1.3485015630722046, 1.2636590003967285, 1.4348371028900146, 1.5527478456497192], [4.080868244171143, 2.827441692352295, 2.5848162174224854, 2.251573324203491, 1.897233009338379, 1.6935714483261108, 1.5782724618911743, 1.5393215417861938, 1.5274219512939453, 1.9509422779083252, 1.8099110126495361, 1.5963232517242432, 1.8947950601577759, 1.5618218183517456, 1.4362530708312988, 1.6500468254089355, 1.173281192779541, 1.5716511011123657, 1.5395264625549316, 1.6753369569778442, 1.69875168800354, 1.2492954730987549, 1.596510648727417, 1.5044481754302979, 1.4568138122558594, 1.4020990133285522, 1.554648518562317, 1.1347415447235107, 1.4782748222351074, 2.0252764225006104, 1.3639793395996094, 1.57852303981781, 1.5640478134155273, 1.2185829877853394, 1.327802062034607, 1.37637460231781, 0.9822097420692444, 1.5354363918304443, 2.0579512119293213, 1.7306270599365234, 1.509594202041626, 1.262621283531189, 1.1728956699371338, 3.510183334350586, 1.375131368637085, 1.4440522193908691, 1.7772489786148071, 1.5952492952346802, 1.9691898822784424, 1.3545302152633667, 1.44077730178833, 1.2055308818817139, 1.5224987268447876, 1.9399408102035522, 1.1257258653640747, 1.360645055770874, 1.8403815031051636, 2.1408543586730957, 1.4552680253982544, 1.4163472652435303, 1.6444923877716064, 1.2953168153762817, 1.169166922569275, 1.5633670091629028, 1.5289677381515503, 1.5813905000686646, 1.6172922849655151, 1.7045038938522339, 1.3459974527359009, 1.3374273777008057, 1.2536813020706177, 1.30497407913208, 1.3561670780181885, 1.1075345277786255, 1.5407487154006958, 1.3190730810165405, 1.3520803451538086, 1.3998831510543823, 1.5516778230667114, 1.1602799892425537, 1.2348783016204834, 1.5749590396881104, 1.299446940422058, 1.7036997079849243, 1.4748826026916504, 1.8041038513183594, 1.4013017416000366, 1.1181182861328125, 1.9250638484954834, 1.783185362815857, 1.254935622215271, 1.3828530311584473, 1.353492259979248, 1.0223742723464966, 1.474319338798523, 1.432578682899475, 1.3421859741210938, 1.361588954925537, 2.011287212371826, 1.3197720050811768]]
global_train_loss_algo: [[], [], []]
